import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as ButtonStories from './c-button.stories';

<Meta of={ButtonStories} />

# Button (`c-button`)

`c-button` は、アクションを実行するためのインタラクティブな要素です。
CSS `if()` 関数を使用して、バリアントやサイズを制御します。

## Public API (CSS Variables)

このコンポーネントは以下のCSS変数を公開しており、外部からカスタマイズ可能です。

### コンテキスト変数

| 変数名      | 値                             | 説明                       |
| :---------- | :----------------------------- | :------------------------- |
| `--variant` | `primary` \| `secondary`       | ボタンのスタイルバリアント |
| `--size`    | `small` \| `medium` \| `large` | ボタンのサイズ             |

### カスタマイズ変数

| 変数名                       | デフォルト値                 | 説明                       |
| :--------------------------- | :--------------------------- | :------------------------- |
| `--c-button-font-family`     | `var(--sys-font-body)`       | フォントファミリー         |
| `--c-button-font-weight`     | `600`                        | フォントウェイト           |
| `--c-button-border-radius`   | `3em`                        | ボーダーの角丸             |
| `--c-button-transition`      | `all 0.2s ease-in-out`       | トランジション             |
| `--c-button-color`           | `var(--sys-text-inverse)`    | テキストカラー             |
| `--c-button-bg`              | `var(--sys-bg-action)`       | 背景色                     |
| `--c-button-shadow`          | `var(--sys-elevation-base)`  | ボックスシャドウ           |
| `--c-button-bg-hover`        | `var(--sys-bg-action-hover)` | ホバー時の背景色           |
| `--c-button-shadow-hover`    | `var(--sys-elevation-md)`    | ホバー時のシャドウ         |
| `--c-button-transform-hover` | `translateY(-2px)`           | ホバー時のトランスフォーム |

## 使用例

### 基本

<Canvas of={ButtonStories.Default} />

<Controls of={ButtonStories.Default} />

### Primary

デフォルトのスタイル。主要なアクションに使用します。
`--variant` と `--size` はデフォルト値（primary, medium）の場合、省略可能です。

```html
<button class="c-button" type="button">Button</button>
```

<Canvas of={ButtonStories.Primary} />

### Secondary

二次的なアクションや、Primaryボタンと並べて使用する場合に適しています。

```html
<button class="c-button" style="--variant: secondary" type="button">Button</button>
```

<Canvas of={ButtonStories.Secondary} />

## サイズバリエーション

### Small

```html
<button class="c-button" style="--size: small" type="button">Button</button>
```

<Canvas of={ButtonStories.Small} />

### Medium

```html
<button class="c-button" type="button">Button</button>
```

<Canvas of={ButtonStories.Medium} />

### Large

```html
<button class="c-button" style="--size: large" type="button">Button</button>
```

<Canvas of={ButtonStories.Large} />

## コンテキストベースのスタイリング

親要素で `--variant` を設定すると、子の `c-button` が自動的に適応します。

```html
<div class="c-card" style="--variant: secondary">
	<!-- この中のボタンは自動的にsecondaryスタイルになる -->
	<button class="c-button" type="button">Button</button>
</div>
```

## 設計思想

このコンポーネントは「APIとしてのCSS」の設計思想に基づいています。

- **CSS `if()` 関数**: 要素自身に条件付きスタイルを適用可能にし、セマンティックなHTML構造を実現
- **カプセル化**: プライベート変数（`--_`プレフィックス）で内部実装を隠蔽し、パブリック変数でカスタマイズを提供
- **シンプルなHTML**: ラッパー要素不要で、`<button>` 要素に直接クラスを適用

## CSS `if()` 関数の採用理由

### 以前の課題：Style Queries の制限

Style Queries（`@container style(...)`）はコンテナの**子孫要素**にのみ適用され、**コンテナ自身には適用されない**制約がありました。

```css
/* Style Queries ではコンテナ自身のスタイルは変更できない */
@container style(--variant: secondary) {
	.c-button {
		--_bg: transparent; /* 適用されない */
	}
}
```

そのため、以前は `<button>` を直接コンポーネントルートにできず、ラッパー `<div>` が必要でした：

```html
<!-- 以前の構造（セマンティクスが犠牲に） -->
<div class="c-button" style="--variant: secondary">
	<button type="button">Button</button>
</div>
```

### 解決策：CSS `if()` 関数

CSS `if()` はプロパティ値の中で直接使えるため、要素自身に条件付きスタイルを適用可能です：

```css
.c-button {
	--_bg: if(
		style(--variant: secondary): transparent;
		else: var(--sys-bg-action)
	);
	background: var(--_bg);
}
```

これにより理想的なHTML構造を実現：

```html
<!-- 現在の構造（セマンティック） -->
<button class="c-button" style="--variant: secondary" type="button">Button</button>
```

### トレードオフ

| 観点                       | Style Queries    | CSS `if()`         |
| :------------------------- | :--------------- | :----------------- |
| HTML構造                   | ❌ ラッパー必要  | ✅ シンプル        |
| バリアント視点の可読性     | ✅ まとまる      | ❌ 散らばる        |
| プロパティ視点の可読性     | ❌ 散らばる      | ✅ まとまる        |
| 新バリアント追加           | ✅ ブロック追加  | ❌ 各if文に追記    |
| 新プロパティ追加           | ❌ 各ブロックに追記 | ✅ 一箇所に追加 |
| ブラウザサポート           | ✅ 広い          | ⚠️ Chrome 137+のみ |

HTML構造のセマンティクスを優先し、CSS `if()` を採用しました。

### ブラウザサポート

CSS `if()` 関数は Chrome 137+ でサポートされています。
このプロジェクトは理想論を追求する実験的なプロジェクトであり、最新の CSS 機能を積極的に採用しています。
