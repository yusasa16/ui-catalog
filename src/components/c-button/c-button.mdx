import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as ButtonStories from './c-button.stories';

<Meta of={ButtonStories} />

# Button (`c-button`)

`c-button` は、アクションを実行するためのインタラクティブな要素です。
CSS変数とStyle Queriesを使用して、バリアントやサイズを制御します。

## Public API (CSS Variables)

このコンポーネントは以下のCSS変数を公開しており、外部からカスタマイズ可能です。

### コンテキスト変数（Style Queries用）

| 変数名      | 値                             | 説明                       |
| :---------- | :----------------------------- | :------------------------- |
| `--variant` | `primary` \| `secondary`       | ボタンのスタイルバリアント |
| `--size`    | `small` \| `medium` \| `large` | ボタンのサイズ             |

### カスタマイズ変数

| 変数名                       | デフォルト値                 | 説明                       |
| :--------------------------- | :--------------------------- | :------------------------- |
| `--c-button-font-family`     | `var(--sys-font-body)`       | フォントファミリー         |
| `--c-button-font-weight`     | `600`                        | フォントウェイト           |
| `--c-button-border-radius`   | `3em`                        | ボーダーの角丸             |
| `--c-button-transition`      | `all 0.2s ease-in-out`       | トランジション             |
| `--c-button-color`           | `var(--sys-text-inverse)`    | テキストカラー             |
| `--c-button-bg`              | `var(--sys-bg-action)`       | 背景色                     |
| `--c-button-shadow`          | `var(--sys-elevation-base)`  | ボックスシャドウ           |
| `--c-button-bg-hover`        | `var(--sys-bg-action-hover)` | ホバー時の背景色           |
| `--c-button-shadow-hover`    | `var(--sys-elevation-md)`    | ホバー時のシャドウ         |
| `--c-button-transform-hover` | `translateY(-2px)`           | ホバー時のトランスフォーム |

## 使用例

### 基本

<Canvas of={ButtonStories.Default} />

<Controls of={ButtonStories.Default} />

### Primary

デフォルトのスタイル。主要なアクションに使用します。
`--variant` と `--size` はデフォルト値（primary, medium）の場合、省略可能です。

```html
<div class="c-button">
	<button type="button">Button</button>
</div>
```

<Canvas of={ButtonStories.Primary} />

### Secondary

二次的なアクションや、Primaryボタンと並べて使用する場合に適しています。

```html
<div class="c-button" style="--variant: secondary">
	<button type="button">Button</button>
</div>
```

<Canvas of={ButtonStories.Secondary} />

## サイズバリエーション

### Small

```html
<div class="c-button" style="--size: small">
	<button type="button">Button</button>
</div>
```

<Canvas of={ButtonStories.Small} />

### Medium

```html
<div class="c-button">
	<button type="button">Button</button>
</div>
```

<Canvas of={ButtonStories.Medium} />

### Large

```html
<div class="c-button" style="--size: large">
	<button type="button">Button</button>
</div>
```

<Canvas of={ButtonStories.Large} />

## コンテキストベースのスタイリング

親コンポーネントで `--variant` を設定すると、子の `c-button` が自動的に適応します。

```html
<div class="c-card" style="--variant: secondary">
	<!-- この中のボタンは自動的にsecondaryスタイルになる -->
	<div class="c-button">
		<button type="button">Button</button>
	</div>
</div>
```

## 設計思想

このコンポーネントは「APIとしてのCSS」の設計思想に基づいています。

- **Style Queries**: `@container style(--variant: ...)` を使用して、親から渡されたコンテキストに基づいてスタイルを適応
- **カプセル化**: プライベート変数（`--_`プレフィックス）で内部実装を隠蔽し、パブリック変数でカスタマイズを提供
- **display: contents**: `.c-button` ラッパーは `display: contents` を使用し、レイアウトに影響を与えない

## 設計上のトレードオフ

### なぜ `<button>` をコンポーネントルートにしないのか

理想的には `<button class="c-button">` のようにbutton要素をルートにしたいが、Style Queriesの制約により断念した。

**Style Queriesの親子関係の制約**

`@container style(--variant: secondary)` は、コンテナの**子孫要素**に対してのみ適用され、**コンテナ自身には適用されない**。

```css
/* これは動作しない - コンテナ自身のスタイルは変更できない */
@container style(--variant: secondary) {
	.c-button {
		--_bg: transparent; /* 適用されない */
	}
}
```

button要素をルートにした場合、button自身がコンテナとなるため、Style Queryで内部変数を上書きできない。

### 検討した代替案

1. **`<button>` + 内部 `<span>`**
   - buttonがコンテナ、spanにビジュアルスタイルを適用
   - 問題: 内部変数の上書きはbuttonで行いたいが、Style Queryはspanにしか適用されない

2. **data属性によるmodifier**
   - `<button class="c-button" data-variant="secondary">`
   - 問題: 親コンポーネントからのコンテキスト継承ができなくなる（CSSだけで親から子のバリアントを変更できない）

### 採用した構造

```html
<div class="c-button" style="--variant: secondary">
	<button type="button">Button</button>
</div>
```

- **div**: Style Queriesのホスト（コンテナ）、内部変数の定義と上書き
- **button**: 子孫要素として内部変数を継承し、ビジュアルスタイルを適用

この構造により、親コンポーネントからのコンテキスト継承と、内部変数によるカプセル化の両立を実現している。
